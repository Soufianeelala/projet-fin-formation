{# templates/car/show.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Détails de {{ car.marque }} {{ car.modele }}{% endblock %}

{% block main %}
<section class="car-show">
  <div class="car-show__card">
    {# ——— Galerie de 3 photos ——— #}
    <div class="car-show__gallery">
      {% for image in car.images|slice(0,3) %}
        <div class="car-show__slide">
          <img 
            src="{{ asset(image.filePath) }}"
            alt="{{ car.marque }} {{ car.modele }}"
            class="js-thumb"
          >
        </div>
      {% else %}
        <div class="car-show__slide placeholder">
          Aucune image
        </div>
      {% endfor %}
    </div>

    {# ——— Détails ——— #}
    <div class="car-show__details">
      <h2 class="car-show__title">{{ car.marque }} {{ car.modele }}</h2>
      <dl class="car-show__list">
        <div><dt><h4>Matricule</h4></dt><dd>{{ car.matricule }}</dd></div>
        <div><dt><h4>Année</3></dt><dd>{{ car.annee }}</dd></div>
          <p class="car-card__category">
          Catégories : {{ car.categories|length > 0 
          ? car.categories|map(c => c.nom)|join(', ') 
          : '—' 
          }}
</p>
        <div><dt><h4>Motorisations</h4></dt>
          <dd>{{ car.motorisationTypes|map(t => t.nom)|join(', ') ?: '—' }}</dd>
        </div>
        <div><dt><h4>Performances</h4></dt>
          <dd>
            <ul class="performance-list">
              {% for pc in car.performanceCars %}
                <li><strong>{{ pc.performanceType.nom }}:</strong> {{ pc.valeur }}</li>
              {% else %}
                <li>— Aucune performance</li>
              {% endfor %}
            </ul>
          </dd>
        </div>
        <div><dt><h4>Propriétaire</h4></dt><dd>{{ car.user.email }}</dd></div>
      </dl>

      <div class="car-show__actions">
        <a href="{{ path('app_car_index') }}" class="btn retour-btn">
          ← Retour à la liste
        </a>
        {% if app.user and (car.user == app.user or is_granted('ROLE_ADMIN')) %}
          <a href="{{ path('app_car_edit', {id: car.id}) }}" class="btn btncarshow-edit">
            <i class="fas fa-edit"></i> Modifier
          </a>
<form method="post" action="{{ path('app_car_delete', {'id': car.id}) }}" onsubmit="return confirm('Confirmer la suppression ?');" style="display: inline;">
  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ car.id) }}">
  <button type="submit" class="btn btncarshow-delete">
    <i class="fas fa-trash-alt"></i> Supprimer
  </button>
</form>        {% endif %}
      </div>
    </div>
  </div>
</section>

{# ——— Lightbox overlay ——— #}
<div id="lightbox-overlay" style="
  display:none;
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.8);
  justify-content:center; align-items:center;
  z-index:10000;
">
  <img id="lightbox-img" src="" alt="" style="
    max-width:90%; max-height:90%;
    border-radius:8px;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
  ">
</div>
{% endblock %}

{% block javascripts %}
  {{ parent() }}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const overlay = document.getElementById('lightbox-overlay');
      const lightboxImg = document.getElementById('lightbox-img');

      document.querySelectorAll('.js-thumb').forEach(thumb => {
        thumb.style.cursor = 'zoom-in';
        thumb.addEventListener('click', () => {
          lightboxImg.src = thumb.src;
          lightboxImg.alt = thumb.alt;
          overlay.style.display = 'flex';
        });
      });

      overlay.addEventListener('click', () => {
        overlay.style.display = 'none';
        lightboxImg.src = '';
      });
    });
  </script>
{% endblock %}
