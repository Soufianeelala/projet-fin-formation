{% extends 'base.html.twig' %}

{% block title %}Nos véhicules{% endblock %}

{% block main %}
{% if app.user %}
 {% if app.user %}
 <h1 class="galerievoiture_title">Galerie des Voitures</h1>

<form method="get" action="{{ path('app_car_index') }}">
    <div class="filter">
        <!-- Filtrer par marque -->
        <label for="marque" class="filter-label">Marque :</label>
        <select name="marque" id="marque" class="filter-select">
            <option value="">Toutes les marques</option>
            {% for marque in marques %}
                <option value="{{ marque.marque }}" {% if marque.marque == app.request.get('marque') %}selected{% endif %}>
                    {{ marque.marque }}
                </option>
            {% endfor %}
        </select>

        <!-- Tri des résultats -->
        <div class="filter-buttons">
            <a href="{{ path('app_car_index', {'filter': 'date_desc'}) }}" class="filter-link">Trier par année décroissante</a>
            <a href="{{ path('app_car_index', {'filter': 'date_asc'}) }}" class="filter-link">Trier par année croissante</a>
        </div>

        <!-- Soumettre le formulaire -->
        <button type="submit" class="filter-submit">Filtrer</button>
    </div>
</form>




<div class="create-btn-container">
  <a href="{{ path('app_car_new') }}" class="create-btn">
    <i class="fas fa-car"></i>
   
    Ajouter ta voiture <i class="fas fa-plus"></i>
  </a>
</div>


{% endif %}

{% endif %}
<section class="car-grid">
  {% for car in cars %}
    <div class="car-card">
      {% if car.images|length > 0 %}
        <img 
          src="{{ asset(car.images|first.filePath) }}" 
          alt="{{ car.marque }} {{ car.modele }}" 
          class="car-card__img"
        >
      {% else %}
        <div class="car-card__img car-card__img--placeholder">
          Aucune image
        </div>
      {% endif %}

      <div class="car-card__body">
        <h3 class="car-card__title">{{ car.marque }} {{ car.modele }}</h3>
        <p class="car-card__year">Année : {{ car.annee }}</p>
        
        <div class="car-card__actions">
          <a href="{{ path('app_car_show', {id: car.id}) }}" class="btn btn--icon">
            <i class="fas fa-eye"></i>
          </a>
          {% if app.user and (car.user == app.user or is_granted('ROLE_ADMIN')) %}
            <a href="{{ path('app_car_edit', {id: car.id}) }}" class="btn btn--icon btn--edit">
              <i class="fas fa-edit"></i>
            </a>
          {% endif %}
        </div>
      </div>
    </div>
  {% else %}
    <p class="no-cars">Aucune voiture disponible.</p>
  {% endfor %}
</section>


{% endblock %}
